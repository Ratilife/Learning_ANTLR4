# Документация для грамматики STFile.g4

## Обзор
Файл `STFile.g4` содержит формальное описание грамматики для файлов формата ST с использованием ANTLR 4. 
Грамматика определяет синтаксическую структуру ST-файлов, включая правила для разбора папок, шаблонов и их атрибутов.

## Структура грамматики

### 1. Лексические правила (токены)

| Токен       | Описание                                | Пример               |
|-------------|-----------------------------------------|----------------------|
| `BOM`       | Byte Order Mark (пропускается)          | `\uFEFF`             |
| `INT`       | Целое число (обычные и Unicode цифры)   | `123`, `１２３`         |
| `STRING`    | Строка в двойных кавычках               | `"текст"`            |
| `LBRACE`    | Открывающая фигурная скобка             | `{`                  |
| `RBRACE`    | Закрывающая фигурная скобка             | `}`                  |
| `WS`        | Пробельные символы (пропускаются)       | ` `, `\t`, `\n`      |

### 2. Синтаксические правила

#### Основные структуры:

1. **fileStructure** - корневая структура файла:
   ```
   { INT ',' rootContent }
   ```

2. **rootContent** - содержимое корневого уровня:
   ```
   { INT ',' folderContent }
   ```

3. **folderContent** - содержимое папки:
   ```
   folderHeader (',' entry)*
   ```

#### Элементы:

4. **entry** - элемент (папка или шаблон):
   ```antlr
   // Папка:
   { INT ',' folderHeader ',' entryList }
   
   // Шаблон:
   { '0' ',' templateHeader }
   ```

5. **entryList** - список элементов:
   ```
   entry (',' entry)*
   ```

#### Заголовки:

6. **folderHeader** - заголовок папки:
   ```antlr
   {
     STRING ','  // имя
     INT ','     // тип
     INT ','     // флаги 
     STRING ','  // тип данных
     STRING      // описание
   }
   ```

7. **templateHeader** - заголовок шаблона:
   ```antlr
   {
     STRING ','  // имя
     '0' ','     // тип (фиксированное значение)
     ('0'|'1') ',' // флаги (0 или 1)
     STRING ','  // тип данных
     STRING      // описание
   }
   ```

## Пример корректного ST-файла

```st
{
  1001,
  {
    "Главная папка",
    1,
    0,
    "Основной тип",
    "Описание главной папки"
  },
  {
    2001,
    {
      "Подпапка",
      2,
      1,
      "Дочерний тип",
      "Описание подпапки"
    },
    {
      0,
      {
        "Шаблон1",
        0,
        1,
        "Тип шаблона",
        "Описание шаблона"
      }
    }
  }
}
```

## Особенности формата

1. **Иерархическая структура**:
   - Файл содержит древовидную структуру папок и шаблонов
   - Папки могут содержать другие папки и шаблоны
   - Шаблоны являются конечными элементами

2. **Типизация элементов**:
   - Папки имеют произвольный числовой тип
   - Шаблоны всегда имеют тип 0
   - Флаги шаблонов могут быть только 0 или 1

3. **Строковые значения**:
   - Все строки заключаются в двойные кавычки
   - Поддерживается экранирование кавычек через удвоение (`""`)

4. **Числовые значения**:
   - Поддерживаются обычные и Unicode цифры
   - Нет ограничений на размер чисел

## Генерация парсера

Для генерации парсера на Python выполните:
```bash
antlr4 -Dlanguage=Python3 STFile.g4
```

Эта команда создаст:
- `STFileLexer.py` - лексический анализатор
- `STFileParser.py` - синтаксический анализатор
- `STFileListener.py` - базовый класс для обработки дерева разбора

## Ограничения

1. Не поддерживает однострочные/многострочные комментарии
2. Нет проверки семантической корректности (например, уникальность ID)
3. Поддерживает только UTF-8 кодировку

## Рекомендации по использованию

1. Для обработки больших файлов используйте потоковый разбор
2. Для удобства работы создайте собственный `STFileListener`
3. Добавьте семантические проверки после синтаксического разбора

Грамматика обеспечивает базовый синтаксический анализ ST-файлов и может быть расширена для поддержки дополнительных возможностей.