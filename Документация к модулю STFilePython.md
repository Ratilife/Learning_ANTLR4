# Документация к модулю STFilePython

## Общее описание

Модуль `STFilePython` представляет собой инструмент для анализа и визуализации ST-файлов, который:
1. Проверяет синтаксическую корректность файлов
2. Строит дерево разбора
3. Визуализирует структуру файла в виде графа
4. Обеспечивает детальную диагностику ошибок

Основные функции:
- Лексический и синтаксический анализ ST-файлов
- Проверка баланса скобок
- Визуализация структуры файла
- Подробное логирование процесса разбора
- Обработка ошибок с указанием точного местоположения

## Основные компоненты модуля

### 1. Класс STFileInfoListener

Наследуется от `STFileCustomListener` и реализует:
- Логирование процесса разбора
- Обработку синтаксических ошибок
- Форматированный вывод информации

#### Методы:
- `enterEveryRule(ctx)` - вызывается при входе в правило, выводит информацию о правиле
- `exitEveryRule(ctx)` - вызывается при выходе из правила
- `syntaxError(...)` - обработчик синтаксических ошибок с указанием строки и позиции
- `get_errors()` - возвращает список найденных ошибок

### 2. Класс TreeGraphListener

Реализует построение графа структуры файла с использованием библиотеки NetworkX.

#### Методы:
- `enterEveryRule(ctx)` - добавляет узел для каждого правила в граф
- `visitTerminal(node)` - добавляет терминальные узлы (лексемы) в граф

### 3. Вспомогательные функции

- `read_file_with_bom(file_path)` - читает файл с учетом BOM (Byte Order Mark)
- `check_braces_balance(file_content)` - проверяет баланс фигурных скобок в файле

### 4. Функция main()

Основная функция, которая:
1. Читает и проверяет файл
2. Выполняет лексический анализ
3. Выполняет синтаксический анализ
4. Визуализирует результат

## Пример использования

```python
if __name__ == "__main__":
    main()  # Анализирует файл "Новый2.st"
```

## Детальное описание функциональности

### 1. Проверка файла

Перед анализом выполняются:
1. Чтение файла с обработкой BOM
2. Проверка баланса скобок:
   - Подсчет открывающих и закрывающих скобок
   - Определение позиций несбалансированных скобок

### 2. Лексический анализ

Используется `STFileLexer` для:
- Разбиения входного текста на токены
- Определения типа каждого токена
- Фиксации позиции токенов в файле

### 3. Синтаксический анализ

Используется `STFileParser` для:
- Построения дерева разбора
- Проверки соответствия структуры файла грамматике
- Сбора информации о правилах и их вложенности

### 4. Обработка ошибок

Реализована многоуровневая обработка ошибок:
1. Баланс скобок (на уровне предварительной проверки)
2. Синтаксические ошибки (в процессе разбора)
3. Контекстные ошибки (в процессе проверки параметров)

При обнаружении ошибки выводится:
- Номер строки и позиция
- Контекст правила
- Текст строки с ошибкой
- Указатель на проблемное место

### 5. Визуализация

Используются библиотеки:
- `networkx` - для представления структуры в виде графа
- `matplotlib` - для отображения графа

Граф отображает:
- Узлы - правила грамматики и терминалы
- Ребра - отношения между правилами

## Пример вывода

При успешном разборе:
```
Скобки сбалансированы.
1:0 LBRACE = '{'
1:1 INT = '100'
1:4 T__0 = ','
...
Файл успешно разобран без ошибок
```

При ошибке:
```
Line 5:10 - правило: templateHeader - ошибка: missing STRING at ','
    { "Template", 0, , "type", "desc" }
              ^
```

## Требования

Для работы модуля необходимы:
- Python 3.6+
- Установленные пакеты:
  - `antlr4-python3-runtime`
  - `networkx`
  - `matplotlib`

## Настройка

1. Указать путь к анализируемому файлу в `main()` (по умолчанию "Новый2.st")
2. При необходимости изменить параметры визуализации в `main()`

## Ограничения

1. Максимальная длина выводимого текста контекста ограничена 50 символами
2. Визуализация может быть неудобной для очень больших файлов
3. Поддерживается только кодировка UTF-8 (с BOM или без)

## Дальнейшее развитие

1. Добавление поддержки других кодировок
2. Реализация экспорта структуры в другие форматы (JSON, XML)
3. Улучшение обработки ошибок с предложениями по исправлению
4. Оптимизация визуализации для больших файлов