# Документация к модулю STFileParser

## Общее описание

Модуль `STFileParser` представляет собой синтаксический анализатор (парсер) для файлов специального формата ST, сгенерированный автоматически с помощью ANTLR 4.13.1 на основе грамматики `STFile.g4`. Парсер обеспечивает разбор структуры ST-файлов и построение дерева разбора.

Основные функции:
- Анализ структуры ST-файлов
- Проверка синтаксической корректности
- Построение иерархического дерева разбора
- Обработка ошибок формата

## Формат ST-файлов

ST-файлы имеют следующую базовую структуру:
```st
{ 
  ID ',' 
  { 
    ID ',' 
    folderContent 
  } 
}
```
где `folderContent` может содержать вложенные папки и шаблоны.

## Основные компоненты модуля

### 1. Класс STFileParser

Основной класс парсера, содержащий:
- Константы токенов
- Правила грамматики
- Методы для разбора каждого элемента структуры

#### Атрибуты:
- `grammarFileName` - имя файла грамматики ('STFile.g4')
- `ruleNames` - список имен всех правил грамматики
- `literalNames` - буквенные обозначения токенов
- `symbolicNames` - символьные обозначения токенов
- `atn` - автоматная сеть переходов
- `decisionsToDFA` - детерминированные конечные автоматы
- `sharedContextCache` - кеш контекстов

#### Константы токенов:
- `T__0` = 1 - Запятая ','
- `T__1` = 2 - Цифра '0' (маркер шаблона)
- `T__2` = 3 - Цифра '1'
- `BOM` = 4 - Byte Order Mark
- `INT` = 5 - Целое число
- `STRING` = 6 - Текстовая строка
- `LBRACE` = 7 - Открывающая фигурная скобка '{'
- `RBRACE` = 8 - Закрывающая фигурная скобка '}'
- `WS` = 9 - Пробельные символы

### 2. Классы контекста

Для каждого правила грамматики определен свой класс контекста:

1. `FileStructureContext` - корневая структура всего файла
2. `RootContentContext` - содержимое корневого уровня
3. `FolderContentContext` - содержимое папки (может включать другие папки и шаблоны)
4. `EntryContext` - отдельный элемент (папка или шаблон)
5. `EntryListContext` - список элементов (вложенных папок/шаблонов)
6. `FolderHeaderContext` - заголовок папки (метаданные и параметры)
7. `TemplateHeaderContext` - заголовок шаблона (метаданные и параметры)

### 3. Методы парсера

Основные методы для разбора структуры файла:

1. `fileStructure()` - разбирает корневую структуру файла
2. `rootContent()` - разбирает содержимое корневого уровня
3. `folderContent()` - разбирает содержимое папки
4. `entry()` - разбирает отдельный элемент (папку или шаблон)
5. `entryList()` - разбирает список элементов
6. `folderHeader()` - разбирает заголовок папки
7. `templateHeader()` - разбирает заголовок шаблона

## Пример использования

```python
from antlr4 import *
from STFileLexer import STFileLexer
from STFileParser import STFileParser

# Создание входного потока
input_stream = FileStream("example.st")

# Лексический анализ
lexer = STFileLexer(input_stream)
stream = CommonTokenStream(lexer)

# Синтаксический анализ
parser = STFileParser(stream)
tree = parser.fileStructure()

# Обработка дерева разбора
# ...
```

## Детальное описание правил грамматики

### 1. fileStructure (корневая структура файла)

Формат:
```st
{ INT ',' rootContent }
```

Пример:
```st
{ 100, { 1, folderContent } }
```

Методы контекста:
- `LBRACE()` - получить токен '{'
- `INT()` - получить числовой идентификатор
- `rootContent()` - получить содержимое корневого уровня
- `RBRACE()` - получить токен '}'

### 2. rootContent (содержимое корневого уровня)

Формат:
```st
'{' INT ',' folderContent '}'
```

Пример:
```st
{
    1001,
    {
        "MainFolder", 1, 0, "type", "description"
    },
    {
        2001,
        {
            "SubFolder", 1, 0, "type", "description"
        },
        ...
    }
}
```

### 3. folderContent (содержимое папки)

Формат:
```st
folderHeader (',' entry)*
```

Пример:
```st
{ "Folder1", 1, 0, "type1", "desc1" }, 
{ 101, { "SubFolder", 1, 0, "type2", "desc2" }, [...] }, 
{ 0, { "Template1", 0, 1, "tpl_type", "tpl_desc" } }
```

### 4. entry (элемент - папка или шаблон)

Варианты:
1. Папка:
```st
{ INT ',' folderHeader ',' entryList }
```
Пример:
```st
{ 1, { "Folder", 1, 0, "type", "desc" }, [вложенные элементы] }
```

2. Шаблон:
```st
{ '0' ',' templateHeader }
```
Пример:
```st
{ 0, { "Template", 0, 1, "type", "desc" } }
```

### 5. entryList (список элементов)

Формат:
```st
entry (',' entry)*
```

### 6. folderHeader (заголовок папки)

Формат:
```st
'{' STRING ',' INT ',' INT ',' STRING ',' STRING '}'
```

Пример:
```st
{ "FolderName", 1, 0, "folder_type", "description" }
```

### 7. templateHeader (заголовок шаблона)

Формат:
```st
'{' STRING ',' '0' ',' ('0'|'1') ',' STRING ',' STRING '}'
```

Пример:
```st
{ "TemplateName", 0, 1, "template_type", "description" }
```

## Обработка ошибок

Парсер генерирует исключение `RecognitionException` при обнаружении синтаксических ошибок, таких как:
- Неправильный порядок элементов
- Отсутствие обязательных элементов
- Несоответствие типов токенов

## Зависимости

Модуль требует установки:
- Python 3.6+
- ANTLR 4.13.1 runtime для Python

## Генерация парсера

Парсер был сгенерирован автоматически из грамматики `STFile.g4` с помощью команды:
```
antlr4 -Dlanguage=Python3 STFile.g4
```

## Заключение

Модуль `STFileParser` предоставляет полный набор инструментов для анализа структуры ST-файлов, проверки их корректности и извлечения данных в удобном для обработки виде.